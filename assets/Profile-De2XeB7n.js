import{w as E,u as S,r as s,j as e,U as P,m as _,d as z,X as L,i as O,x as M}from"./index-DY7piRvx.js";import{P as A}from"./pen-BEsh3XwX.js";import{P as h}from"./package-CVrMn48j.js";import{C as F}from"./credit-card-BkXDgmpU.js";import{L as R}from"./log-out-D4im8pDC.js";function K(){const{user:t,loading:i,logout:f,updateProfile:y}=E(),d=S(),[p,j]=s.useState([]),[k,v]=s.useState(!0),[o,n]=s.useState(!1),[l,c]=s.useState({name:"",phone:""}),[x,g]=s.useState(!1),[b,m]=s.useState("");s.useEffect(()=>{!i&&!t&&d("/login")},[t,i,d]),s.useEffect(()=>{(async()=>{if(t)try{const{data:a,error:u}=await M.from("orders").select(`
                        id,
                        order_number,
                        total,
                        status,
                        created_at,
                        order_items (
                            product_name,
                            quantity
                        )
                    `).eq("customer_email",t.email).order("created_at",{ascending:!1}).limit(5);if(u)throw u;j(a||[])}catch(a){console.error("Error fetching orders:",a)}finally{v(!1)}})()},[t]),s.useEffect(()=>{o&&t&&(c({name:t.name||"",phone:t.phone||""}),m(""))},[o,t]);const N=async r=>{r.preventDefault(),g(!0),m("");const a=await y(l);a.success?n(!1):m(a.error||"Failed to update profile"),g(!1)},w=async()=>{await f(),d("/login")},C=r=>{const a={pending:"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400",processing:"bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400",shipped:"bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-400",delivered:"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400",cancelled:"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400"};return a[r]||a.pending};return i?e.jsx("div",{className:"min-h-screen pt-32 flex justify-center",children:e.jsx("div",{className:"w-8 h-8 border-4 border-brand-primary border-t-transparent rounded-full animate-spin"})}):t?e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-32 pb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-serif text-brand-primary dark:text-gray-100 font-bold mb-10 text-center md:text-left",children:"My Account"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"md:col-span-4 lg:col-span-3 space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 flex flex-col items-center text-center",children:[t.avatar?e.jsx("img",{src:t.avatar,alt:t.name,className:"w-24 h-24 rounded-full object-cover mb-4"}):e.jsx("div",{className:"w-24 h-24 bg-brand-primary/10 rounded-full flex items-center justify-center mb-4 text-brand-primary dark:text-brand-accent",children:e.jsx(P,{size:48})}),e.jsx("h2",{className:"text-xl font-serif font-bold text-brand-primary dark:text-gray-100",children:t.name||"User"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-2",children:t.email}),t.phone&&e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:t.phone}),e.jsxs("button",{onClick:()=>n(!0),className:"w-full py-2 px-4 border border-brand-primary/20 text-brand-primary dark:text-gray-300 rounded-full hover:bg-brand-primary hover:text-white transition-colors text-sm font-bold uppercase tracking-wider flex items-center justify-center gap-2",children:[e.jsx(A,{size:16}),"Edit Profile"]})]}),e.jsx("div",{className:"glass-panel p-2",children:e.jsxs("nav",{className:"space-y-1",children:[e.jsxs("button",{className:"w-full flex items-center space-x-3 px-4 py-3 bg-brand-primary/5 dark:bg-white/5 text-brand-primary dark:text-brand-accent font-bold rounded-lg transition-colors",children:[e.jsx(h,{size:20}),e.jsx("span",{children:"Orders"})]}),e.jsxs("button",{className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 hover:text-brand-primary dark:hover:text-gray-200 rounded-lg transition-colors",children:[e.jsx(_,{size:20}),e.jsx("span",{children:"Addresses"})]}),e.jsxs("button",{className:"w-full flex items-center space-x-3 px-4 py-3 text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-white/5 hover:text-brand-primary dark:hover:text-gray-200 rounded-lg transition-colors",children:[e.jsx(F,{size:20}),e.jsx("span",{children:"Payment Methods"})]}),e.jsx("div",{className:"h-px bg-gray-100 dark:bg-white/10 my-2"}),e.jsxs("button",{onClick:w,className:"w-full flex items-center space-x-3 px-4 py-3 text-red-500 hover:bg-red-50 dark:hover:bg-red-500/10 rounded-lg transition-colors",children:[e.jsx(R,{size:20}),e.jsx("span",{children:"Sign Out"})]})]})})]}),e.jsx("div",{className:"md:col-span-8 lg:col-span-9 space-y-8",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-serif text-brand-primary dark:text-gray-100 font-bold mb-6",children:"Recent Orders"}),k?e.jsx("div",{className:"glass-panel p-12 flex justify-center",children:e.jsx("div",{className:"w-6 h-6 border-4 border-brand-primary border-t-transparent rounded-full animate-spin"})}):p.length===0?e.jsxs("div",{className:"glass-panel p-12 text-center",children:[e.jsx(h,{size:48,className:"mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-lg",children:"No orders yet"}),e.jsx("button",{onClick:()=>d("/products"),className:"mt-6 px-6 py-3 bg-brand-accent text-white rounded-full hover:bg-brand-accent/90 transition-colors font-bold",children:"Start Shopping"})]}):e.jsx("div",{className:"space-y-4",children:p.map(r=>e.jsxs("div",{className:"glass-panel p-6 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4 group hover:border-brand-accent/30 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"space-y-1 flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("span",{className:"text-lg font-bold text-brand-primary dark:text-white",children:r.order_number}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full ${C(r.status)}`,children:r.status})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Placed on ",new Date(r.created_at).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),r.order_items&&r.order_items.length>0&&e.jsxs("p",{className:"text-sm text-brand-primary dark:text-gray-300",children:[e.jsx("span",{className:"font-semibold",children:"Items:"})," ",r.order_items.slice(0,2).map(a=>a.product_name).join(", "),r.order_items.length>2&&` +${r.order_items.length-2} more`]})]}),e.jsxs("div",{className:"flex items-center gap-6 w-full sm:w-auto justify-between sm:justify-end",children:[e.jsxs("p",{className:"text-lg font-bold text-brand-accent",children:["PKR ",r.total.toLocaleString()]}),e.jsx(z,{size:24,className:"text-gray-400 group-hover:text-brand-primary dark:group-hover:text-white transition-colors"})]})]},r.id))})]})})]}),o&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>n(!1),children:e.jsxs("div",{className:"glass-panel max-w-md w-full p-8 space-y-6 animate-fade-in-up",onClick:r=>r.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-2xl font-serif font-bold text-brand-primary dark:text-white",children:"Edit Profile"}),e.jsx("button",{onClick:()=>n(!1),className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-white rounded-lg transition-colors",children:e.jsx(L,{size:24})})]}),b&&e.jsxs("div",{className:"flex items-center gap-2 p-4 bg-red-50 dark:bg-red-500/10 border border-red-200 dark:border-red-500/20 rounded-xl text-red-600 dark:text-red-400 text-sm",children:[e.jsx(O,{size:18}),e.jsx("span",{children:b})]}),e.jsxs("form",{onSubmit:N,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 ml-1",children:"Full Name"}),e.jsx("input",{type:"text",value:l.name,onChange:r=>c({...l,name:r.target.value}),className:"w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-brand-accent/50 focus:border-brand-accent outline-none transition-all dark:text-white",required:!0})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 ml-1",children:"Phone Number"}),e.jsx("input",{type:"tel",value:l.phone,onChange:r=>c({...l,phone:r.target.value}),className:"w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl focus:ring-2 focus:ring-brand-accent/50 focus:border-brand-accent outline-none transition-all dark:text-white",placeholder:"+92 300 1234567"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"flex-1 px-6 py-3 border border-gray-300 dark:border-white/10 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-50 dark:hover:bg-white/5 transition-colors font-bold",disabled:x,children:"Cancel"}),e.jsx("button",{type:"submit",disabled:x,className:"flex-1 px-6 py-3 bg-brand-accent text-white rounded-xl hover:bg-brand-accent/90 transition-colors font-bold disabled:opacity-50 disabled:cursor-not-allowed",children:x?e.jsx("span",{className:"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin inline-block"}):"Save Changes"})]})]})]})})]}):null}export{K as Profile};
